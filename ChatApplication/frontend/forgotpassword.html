<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ChatApp — Reset Password</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
<link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
<button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
<span class="material-icons">light_mode</span>
</button>
<main class="page-wrap centered">
<section class="card-centered">
<div class="login-card">
<div class="forgot-icon">
<span class="material-icons">chat_bubble_outline</span>
</div>
<h2 class="forgot-title">Reset Your Password</h2>
<p class="forgot-desc">Enter your email and new password to reset your account password.</p>

<form class="forgot-form" id="resetPasswordForm">
<label class="field">
<span class="label">Email Address</span>
<div class="input-row">
<input id="forgot-email" type="email" placeholder="you@example.com" required />
<span class="input-icon material-icons">mail_outline</span>
</div>
</label>

<label class="field">
<span class="label">New Password</span>
<div class="input-row">
<input id="new-password" type="password" placeholder="Enter new password" required />
<span class="input-icon material-icons">lock</span>
</div>
</label>

<label class="field">
<span class="label">Confirm Password</span>
<div class="input-row">
<input id="confirm-password" type="password" placeholder="Confirm new password" required />
<span class="input-icon material-icons">lock</span>
</div>
</label>

<button type="submit" class="btn primary">Reset Password</button>

<div class="small center" style="margin-top:16px"><a href="index.html">Back to Login</a></div>
</form>
</div>
</section>
</main>

<script>
const API_URL = 'http://localhost:8000/api';

document.getElementById('resetPasswordForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const email = document.getElementById('forgot-email').value;
  const newPassword = document.getElementById('new-password').value;
  const confirmPassword = document.getElementById('confirm-password').value;
  
  // Validate passwords match
  if (newPassword !== confirmPassword) {
    alert('Mật khẩu xác nhận không khớp!');
    return;
  }
  
  if (newPassword.length < 6) {
    alert('Mật khẩu phải có ít nhất 6 ký tự!');
    return;
  }
  
  try {
    const response = await fetch(`${API_URL}/users/reset-password`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        email: email,
        new_password: newPassword
      })
    });
    
    if (response.ok) {
      const data = await response.json();
      alert(data.message || 'Đổi mật khẩu thành công!');
      window.location.href = 'index.html';
    } else {
      const error = await response.json();
      alert(error.detail || 'Có lỗi xảy ra. Vui lòng kiểm tra lại email!');
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Không thể kết nối đến server!');
  }
});
</script>

<script src="assets/js/script.js"></script>
</body>
</html>
